<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<title>AWS CLI Cheatsheet - Nathan Obert</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="AWS CLI Cheatsheet">
		<meta property="og:title" content="AWS CLI Cheatsheet" />
<meta property="og:description" content="AWS CLI Cheatsheet" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://www.nathanobert.com/posts/cheatsheet-aws-cli/" />
<meta property="article:published_time" content="2023-05-03T04:03:00-07:00" />
<meta property="article:modified_time" content="2023-05-03T04:03:00-07:00" />

		<meta itemprop="name" content="AWS CLI Cheatsheet">
<meta itemprop="description" content="AWS CLI Cheatsheet">
<meta itemprop="datePublished" content="2023-05-03T04:03:00-07:00" />
<meta itemprop="dateModified" content="2023-05-03T04:03:00-07:00" />
<meta itemprop="wordCount" content="1401">



<meta itemprop="keywords" content="DEVOPS,AWS,CLI," />
		<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="AWS CLI Cheatsheet"/>
<meta name="twitter:description" content="AWS CLI Cheatsheet"/>

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo logo--mixed">
		<a class="logo__link" href="/" title="Nathan Obert" rel="home">
			<div class="logo__item logo__imagebox">
					<img class="logo__img" src="/img/nathan.jpg">
				</div><div class="logo__item logo__text">
					<div class="logo__title">Nathan Obert</div>
					
				</div>
		</a>
	</div>
		
<nav class="menu">
	<button class="menu__btn" aria-haspopup="true" aria-expanded="false" tabindex="0">
		<span class="menu__btn-title" tabindex="-1">Menu</span>
	</button>
	<ul class="menu__list">
		<li class="menu__item">
			<a class="menu__link" href="/">
				
				<span class="menu__text">Home</span>
				
			</a>
		</li>
		<li class="menu__item">
			<a class="menu__link" href="/categories/blog/">
				
				<span class="menu__text">Blog</span>
				
			</a>
		</li>
		<li class="menu__item">
			<a class="menu__link" href="/categories/cheatsheets/">
				
				<span class="menu__text">Cheatsheets</span>
				
			</a>
		</li>
		<li class="menu__item">
			<a class="menu__link" href="/tags/">
				
				<span class="menu__text">Tags</span>
				
			</a>
		</li>
		<li class="menu__item">
			<a class="menu__link" href="/posts/about/">
				
				<span class="menu__text">About</span>
				
			</a>
		</li>
	</ul>
</nav>


	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">AWS CLI Cheatsheet</h1>
			<p class="post__lead">Cheatsheet for Git</p>
			<div class="post__meta meta"><div class="meta__item-author meta__item">
	<svg class="meta__icon icon icon-author" width="16" height="16" viewBox="0 0 12 16"><path d="M6 1c2.2 0 3.5 2 3.5 4.5C9.5 7 8.9 8.2 8 9c2.9.8 4 2.5 4 5v1H0v-1c0-2.5 1.1-4.2 4-5-.9-.8-1.5-2-1.5-3.5C2.5 3 3.8 1 6 1z"/></svg><span class="meta__text">Nathan Obert</span>
</div>
<div class="meta__item-datetime meta__item">
	<svg class="meta__icon icon icon-time" width="16" height="14" viewBox="0 0 30 28"><path d="M15 0C7 0 1 6 1 14s6 14 14 14 14-6 14-14S23 0 15 0zm0 25C9 25 4 20 4 14S9 3 15 3s11 5 11 11-5 11-11 11zm1-18h-2v8.4l6.8 4.4L22 18l-6-3.8V7z"/></svg><time class="meta__text" datetime="2023-05-03T04:03:00-07:00">2023-05-03</time></div><div class="meta__item-categories meta__item"><svg class="meta__icon icon icon-category" width="16" height="16" viewBox="0 0 16 16"><path d="m7 2l1 2h8v11h-16v-13z"/></svg><span class="meta__text"><a class="meta__link" href="/categories/cheatsheets/" rel="category">Cheatsheets</a>
	</span>
</div>
<div class="post__tags tags clearfix">
        <svg class="tags__badge icon icon-tag" width="16" height="16" viewBox="0 0 32 32"><path d="M32 19c0 1-1 2-1 2L21 31s-1 1-2 1-2-1-2-1L2 16c-1-1-1.4-2-1.4-2S0 12.5 0 11V3C0 1.5.8.8.8.8S1.5 0 3 0h8c1.5 0 3 .6 3 .6S15 1 16 2l15 15s1 1 1 2zM7 10a3 3 0 1 0 0-6 3 3 0 0 0 0 6z"/></svg>
        <ul class="tags__list">
                <li class="tags__item">
                        <a class="tags__link btn" href="/tags/devops/" rel="tag">DEVOPS</a>
                </li>
                <li class="tags__item">
                        <a class="tags__link btn" href="/tags/aws/" rel="tag">AWS</a>
                </li>
                <li class="tags__item">
                        <a class="tags__link btn" href="/tags/cli/" rel="tag">CLI</a>
                </li>
        </ul>
</div>
</div>
		</header>
		
	<figure class="post__thumbnail thumbnail">
		
		<img class="thumbnail__image" src="/img/aws_cli.png" alt="AWS CLI Cheatsheet">
		
	</figure>
<div class="post__toc toc">
	<div class="toc__title">Page content</div>
	<div class="toc__menu">
		<nav id="TableOfContents">
  <ul>
    <li><a href="#introduction">Introduction</a></li>
  </ul>

  <ul>
    <li><a href="#cloudtrail---logging-and-auditing">Cloudtrail - Logging and Auditing</a></li>
    <li><a href="#iam">IAM</a>
      <ul>
        <li><a href="#users">Users</a></li>
        <li><a href="#password-policy">Password policy</a></li>
        <li><a href="#access-keys">Access Keys</a></li>
        <li><a href="#groups-policies-managed-policies">Groups, Policies, Managed Policies</a></li>
      </ul>
    </li>
    <li><a href="#s3">S3</a></li>
    <li><a href="#ec2">EC2</a>
      <ul>
        <li><a href="#keypairs">keypairs</a></li>
        <li><a href="#security-groups">Security Groups</a></li>
      </ul>
    </li>
    <li><a href="#images">Images</a></li>
    <li><a href="#instances">Instances</a>
      <ul>
        <li><a href="#tags">Tags</a></li>
      </ul>
    </li>
    <li><a href="#cloudwatch">Cloudwatch</a>
      <ul>
        <li><a href="#log-groups">Log Groups</a></li>
        <li><a href="#log-streams">Log Streams</a></li>
      </ul>
    </li>
    <li><a href="#cloudwatch---monitoring">Cloudwatch - Monitoring</a></li>
  </ul>
</nav>
	</div>
</div><div class="content post__content clearfix">
			<h2 id="introduction">Introduction</h2>
<p>This cheat sheet from <a href="https://gist.githubusercontent.com/apolloclark/b3f60c1f68aa972d324b/raw/c5b004c4dd660023a3adb13f2c1abd2aa07de389/aws%2520cli%2520cheatsheet.md">Applo Clark&rsquo;s Cheatsheet</a>.  Amazon&rsquo;s <a href="https://docs.aws.amazon.com/cli/">Official CLI Documentation</a>. Amazon Web Services (AWS)&lsquo;s Command Line Interface (CLI) is a shell based means to work with AWS.  The CLI provides the ability to list out resources at Amazon like which EC2 instances are running, poke around S3 buckets, inspect pretty much anything at Amazon.  It also provides advanced features like copying information to and from S3.   Below is a cheat sheet I will be updating over time with frequently used commands.</p>
<h1 id="aws-cli-cheatsheet">AWS CLI Cheatsheet</h1>
<p><a href="http://docs.aws.amazon.com/IAM/latest/UserGuide/best-practices.html">http://docs.aws.amazon.com/IAM/latest/UserGuide/best-practices.html</a>
<a href="https://www.youtube.com/watch?v=_wiGpBQGCjU">https://www.youtube.com/watch?v=_wiGpBQGCjU</a></p>
<h2 id="cloudtrail---logging-and-auditing">Cloudtrail - Logging and Auditing</h2>
<p><a href="http://docs.aws.amazon.com/cli/latest/reference/cloudtrail/">http://docs.aws.amazon.com/cli/latest/reference/cloudtrail/</a>
5 Trails total, with support for resource level permissions</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="color:#75715e"># list all trails</span>
aws cloudtrail describe-trails

<span style="color:#75715e"># list all S3 buckets</span>
aws s3 ls

<span style="color:#75715e"># create a new trail</span>
aws cloudtrail create-subscription <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    --name awslog <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    --s3-new-bucket awslog2016

<span style="color:#75715e"># list the names of all trails</span>
aws cloudtrail describe-trails --output text | cut -f <span style="color:#ae81ff">8</span>

<span style="color:#75715e"># get the status of a trail</span>
aws cloudtrail get-trail-status <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    --name awslog

<span style="color:#75715e"># delete a trail</span>
aws cloudtrail delete-trail <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    --name awslog

<span style="color:#75715e"># delete the S3 bucket of a trail</span>
aws s3 rb s3://awslog2016 --force

<span style="color:#75715e"># add tags to a trail, up to 10 tags</span>
aws cloudtrail add-tags <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    --resource-id awslog <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    --tags-list <span style="color:#e6db74">&#34;Key=log-type,Value=all&#34;</span>

<span style="color:#75715e"># list the tags of a trail</span>
aws cloudtrail list-tags <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    --resource-id-list 

<span style="color:#75715e"># remove a tag from a trail</span>
aws cloudtrail remove-tags <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    --resource-id awslog <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    --tags-list <span style="color:#e6db74">&#34;Key=log-type,Value=all&#34;</span>
</code></pre></div><h2 id="iam">IAM</h2>
<h3 id="users">Users</h3>
<p><a href="https://blogs.aws.amazon.com/security/post/Tx15CIT22V4J8RP/How-to-rotate-access-keys-for-IAM-users">https://blogs.aws.amazon.com/security/post/Tx15CIT22V4J8RP/How-to-rotate-access-keys-for-IAM-users</a>
<a href="http://docs.aws.amazon.com/IAM/latest/UserGuide/reference_iam-limits.html">http://docs.aws.amazon.com/IAM/latest/UserGuide/reference_iam-limits.html</a>
Limits = 5000 users, 100 group, 250 roles, 2 access keys / user</p>
<p><a href="http://docs.aws.amazon.com/cli/latest/reference/iam/index.html">http://docs.aws.amazon.com/cli/latest/reference/iam/index.html</a></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="color:#75715e"># list all user&#39;s info</span>
aws iam list-users

<span style="color:#75715e"># list all user&#39;s usernames</span>
aws iam list-users --output text | cut -f <span style="color:#ae81ff">6</span>

<span style="color:#75715e"># list current user&#39;s info</span>
aws iam get-user

<span style="color:#75715e"># list current user&#39;s access keys</span>
aws iam list-access-keys

<span style="color:#75715e"># crate new user</span>
aws iam create-user <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    --user-name aws-admin2

<span style="color:#75715e"># create multiple new users, from a file</span>
allUsers<span style="color:#f92672">=</span><span style="color:#66d9ef">$(</span>cat ./user-names.txt<span style="color:#66d9ef">)</span>
<span style="color:#66d9ef">for</span> userName in $allUsers; <span style="color:#66d9ef">do</span>
    aws iam create-user <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>        --user-name $userName
<span style="color:#66d9ef">done</span>

<span style="color:#75715e"># list all users</span>
aws iam list-users --no-paginate

<span style="color:#75715e"># get a specific user&#39;s info</span>
aws iam get-user <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    --user-name aws-admin2

<span style="color:#75715e"># delete one user</span>
aws iam delete-user <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    --user-name aws-admin2

<span style="color:#75715e"># delete all users</span>
<span style="color:#75715e"># allUsers=$(aws iam list-users --output text | cut -f 6);</span>
allUsers<span style="color:#f92672">=</span><span style="color:#66d9ef">$(</span>cat ./user-names.txt<span style="color:#66d9ef">)</span>
<span style="color:#66d9ef">for</span> userName in $allUsers; <span style="color:#66d9ef">do</span>
    aws iam delete-user <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>        --user-name $userName
<span style="color:#66d9ef">done</span>
</code></pre></div><h3 id="password-policy">Password policy</h3>
<p><a href="http://docs.aws.amazon.com/cli/latest/reference/iam/">http://docs.aws.amazon.com/cli/latest/reference/iam/</a></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="color:#75715e"># list policy</span>
<span style="color:#75715e"># http://docs.aws.amazon.com/cli/latest/reference/iam/get-account-password-policy.html</span>
aws iam get-account-password-policy

<span style="color:#75715e"># set policy</span>
<span style="color:#75715e"># http://docs.aws.amazon.com/cli/latest/reference/iam/update-account-password-policy.html</span>
aws iam update-account-password-policy <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>	--minimum-password-length <span style="color:#ae81ff">12</span> <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>	--require-symbols <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>	--require-numbers <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>	--require-uppercase-characters <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>	--require-lowercase-characters <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>	--allow-users-to-change-password

<span style="color:#75715e"># delete policy</span>
<span style="color:#75715e"># http://docs.aws.amazon.com/cli/latest/reference/iam/delete-account-password-policy.html</span>
aws iam delete-account-password-policy
</code></pre></div><h3 id="access-keys">Access Keys</h3>
<p><a href="http://docs.aws.amazon.com/cli/latest/reference/iam/">http://docs.aws.amazon.com/cli/latest/reference/iam/</a></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="color:#75715e"># list all access keys</span>
aws iam list-access-keys

<span style="color:#75715e"># list access keys of a specific user</span>
aws iam list-access-keys <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    --user-name aws-admin2

<span style="color:#75715e"># create a new access key</span>
aws iam create-access-key <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    --user-name aws-admin2 <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    --output text | tee aws-admin2.txt

<span style="color:#75715e"># list last access time of an access key</span>
aws iam get-access-key-last-used <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    --access-key-id AKIAINA6AJZY4EXAMPLE

<span style="color:#75715e"># deactivate an acccss key</span>
aws iam update-access-key <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    --access-key-id AKIAI44QH8DHBEXAMPLE <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    --status Inactive <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    --user-name aws-admin2

<span style="color:#75715e"># delete an access key</span>
aws iam delete-access-key <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    --access-key-id AKIAI44QH8DHBEXAMPLE <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    --user-name aws-admin2
</code></pre></div><h3 id="groups-policies-managed-policies">Groups, Policies, Managed Policies</h3>
<p><a href="http://docs.aws.amazon.com/IAM/latest/UserGuide/id_roles.html">http://docs.aws.amazon.com/IAM/latest/UserGuide/id_roles.html</a>
<a href="http://docs.aws.amazon.com/cli/latest/reference/iam/">http://docs.aws.amazon.com/cli/latest/reference/iam/</a></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="color:#75715e"># list all groups</span>
aws iam list-groups

<span style="color:#75715e"># create a group</span>
aws iam create-group --group-name FullAdmins

<span style="color:#75715e"># delete a group</span>
aws iam delete-group <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    --group-name FullAdmins

<span style="color:#75715e"># list all policies</span>
aws iam list-policies

<span style="color:#75715e"># get a specific policy</span>
aws iam get-policy <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    --policy-arn &lt;value&gt;

<span style="color:#75715e"># list all users, groups, and roles, for a given policy</span>
aws iam list-entities-for-policy <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    --policy-arn &lt;value&gt;

<span style="color:#75715e"># list policies, for a given group</span>
aws iam list-attached-group-policies <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    --group-name FullAdmins

<span style="color:#75715e"># add a policy to a group</span>
aws iam attach-group-policy <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    --group-name FullAdmins <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    --policy-arn arn:aws:iam::aws:policy/AdministratorAccess

<span style="color:#75715e"># add a user to a group</span>
aws iam add-user-to-group <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    --group-name FullAdmins <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    --user-name aws-admin2

<span style="color:#75715e"># list users, for a given group</span>
aws iam get-group <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    --group-name FullAdmins

<span style="color:#75715e"># list groups, for a given user</span>
aws iam list-groups-for-user <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    --user-name aws-admin2

<span style="color:#75715e"># remove a user from a group</span>
aws iam remove-user-from-group <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    --group-name FullAdmins <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    --user-name aws-admin2

<span style="color:#75715e"># remove a policy from a group</span>
aws iam detach-group-policy <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    --group-name FullAdmins <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    --policy-arn arn:aws:iam::aws:policy/AdministratorAccess

<span style="color:#75715e"># delete a group</span>
aws iam delete-group <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    --group-name FullAdmins
</code></pre></div><p><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --></p>
<h2 id="s3">S3</h2>
<p><a href="https://docs.aws.amazon.com/cli/latest/reference/s3api/index.html#cli-aws-s3api">https://docs.aws.amazon.com/cli/latest/reference/s3api/index.html#cli-aws-s3api</a></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="color:#75715e"># list existing S3 buckets</span>
aws s3 ls

<span style="color:#75715e"># create a bucket name, using the current date timestamp</span>
bucket_name<span style="color:#f92672">=</span>test_<span style="color:#66d9ef">$(</span>date <span style="color:#e6db74">&#34;+%Y-%m-%d_%H-%M-%S&#34;</span><span style="color:#66d9ef">)</span>
echo $bucket_name

<span style="color:#75715e"># create a public facing bucket</span>
aws s3api create-bucket --acl <span style="color:#e6db74">&#34;public-read-write&#34;</span> --bucket $bucket_name

<span style="color:#75715e"># verify bucket was created</span>
aws s3 ls | grep $bucket_name

<span style="color:#75715e"># check for public facing s3 buckets (should show the bucket name you created)</span>

aws s3api list-buckets --query <span style="color:#e6db74">&#39;Buckets[*].[Name]&#39;</span> --output text | xargs -I <span style="color:#f92672">{}</span> bash -c <span style="color:#e6db74">&#39;if [[ $(aws s3api get-bucket-acl --bucket {} --query &#39;</span><span style="color:#e6db74">&#34;&#39;&#34;</span><span style="color:#e6db74">&#39;Grants[?Grantee.URI==`http://acs.amazonaws.com/groups/global/AllUsers` &amp;&amp; Permission==`READ`]&#39;</span><span style="color:#e6db74">&#34;&#39;&#34;</span><span style="color:#e6db74">&#39; --output text) ]]; then echo {} ; fi&#39;</span>

<span style="color:#75715e"># check for public facing s3 buckets, updated them to be private</span>

aws s3api list-buckets --query <span style="color:#e6db74">&#39;Buckets[*].[Name]&#39;</span> --output text | xargs -I <span style="color:#f92672">{}</span> bash -c <span style="color:#e6db74">&#39;if [[ $(aws s3api get-bucket-acl --bucket {} --query &#39;</span><span style="color:#e6db74">&#34;&#39;&#34;</span><span style="color:#e6db74">&#39;Grants[?Grantee.URI==`http://acs.amazonaws.com/groups/global/AllUsers` &amp;&amp; Permission==`READ`]&#39;</span><span style="color:#e6db74">&#34;&#39;&#34;</span><span style="color:#e6db74">&#39; --output text) ]]; then aws s3api put-bucket-acl --acl &#34;private&#34; --bucket {} ; fi&#39;</span>

<span style="color:#75715e"># check for public facing s3 buckets (should be empty)</span>

aws s3api list-buckets --query <span style="color:#e6db74">&#39;Buckets[*].[Name]&#39;</span> --output text | xargs -I <span style="color:#f92672">{}</span> bash -c <span style="color:#e6db74">&#39;if [[ $(aws s3api get-bucket-acl --bucket {} --query &#39;</span><span style="color:#e6db74">&#34;&#39;&#34;</span><span style="color:#e6db74">&#39;Grants[?Grantee.URI==`http://acs.amazonaws.com/groups/global/AllUsers` &amp;&amp; Permission==`READ`]&#39;</span><span style="color:#e6db74">&#34;&#39;&#34;</span><span style="color:#e6db74">&#39; --output text) ]]; then echo {} ; fi&#39;</span>
</code></pre></div><h2 id="ec2">EC2</h2>
<h3 id="keypairs">keypairs</h3>
<p><a href="http://docs.aws.amazon.com/AWSEC2/latest/UserGuide/ec2-key-pairs.html">http://docs.aws.amazon.com/AWSEC2/latest/UserGuide/ec2-key-pairs.html</a></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="color:#75715e"># list all keypairs</span>
<span style="color:#75715e"># http://docs.aws.amazon.com/cli/latest/reference/ec2/describe-key-pairs.html</span>
aws ec2 describe-key-pairs

<span style="color:#75715e"># create a keypair</span>
<span style="color:#75715e"># http://docs.aws.amazon.com/cli/latest/reference/ec2/create-key-pair.html</span>
aws ec2 create-key-pair <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    --key-name &lt;value&gt; --output text

<span style="color:#75715e"># create a new local private / public keypair, using RSA 4096-bit</span>
ssh-keygen -t rsa -b <span style="color:#ae81ff">4096</span>

<span style="color:#75715e"># import an existing keypair</span>
<span style="color:#75715e"># http://docs.aws.amazon.com/cli/latest/reference/ec2/import-key-pair.html</span>
aws ec2 import-key-pair <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    --key-name keyname_test <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    --public-key-material file:///home/apollo/id_rsa.pub

<span style="color:#75715e"># delete a keypair</span>
<span style="color:#75715e"># http://docs.aws.amazon.com/cli/latest/reference/ec2/delete-key-pair.html</span>
aws ec2 delete-key-pair <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    --key-name &lt;value&gt;
</code></pre></div><h3 id="security-groups">Security Groups</h3>
<p><a href="http://docs.aws.amazon.com/cli/latest/reference/ec2/index.html">http://docs.aws.amazon.com/cli/latest/reference/ec2/index.html</a></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="color:#75715e"># list all security groups</span>
aws ec2 describe-security-groups

<span style="color:#75715e"># create a security group</span>
aws ec2 create-security-group <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    --vpc-id vpc-1a2b3c4d <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    --group-name web-access <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    --description <span style="color:#e6db74">&#34;web access&#34;</span>

<span style="color:#75715e"># list details about a securty group</span>
aws ec2 describe-security-groups <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    --group-id sg-0000000

<span style="color:#75715e"># open port 80, for everyone</span>
aws ec2 authorize-security-group-ingress <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    --group-id sg-0000000 <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    --protocol tcp <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    --port <span style="color:#ae81ff">80</span> <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    --cidr 0.0.0.0/24

<span style="color:#75715e"># get my public ip</span>
my_ip<span style="color:#f92672">=</span><span style="color:#66d9ef">$(</span>dig +short myip.opendns.com @resolver1.opendns.com<span style="color:#66d9ef">)</span>;
echo $my_ip

<span style="color:#75715e"># open port 22, just for my ip</span>
aws ec2 authorize-security-group-ingress <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    --group-id sg-0000000 <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    --protocol tcp <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    --port <span style="color:#ae81ff">80</span> <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    --cidr $my_ip/24

<span style="color:#75715e"># remove a firewall rule from a group</span>
aws ec2 revoke-security-group-ingress <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    --group-id sg-0000000 <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    --protocol tcp <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    --port <span style="color:#ae81ff">80</span> <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    --cidr 0.0.0.0/24

<span style="color:#75715e"># delete a security group</span>
aws ec2 delete-security-group <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    --group-id sg-00000000
</code></pre></div><h2 id="images">Images</h2>
<p><a href="https://docs.aws.amazon.com/cli/latest/reference/ec2/describe-images.html">https://docs.aws.amazon.com/cli/latest/reference/ec2/describe-images.html</a></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="color:#75715e"># list all private AMI&#39;s, ImageId and Name tags</span>
aws ec2 describe-images --filter <span style="color:#e6db74">&#34;Name=is-public,Values=false&#34;</span> <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    --query <span style="color:#e6db74">&#39;Images[].[ImageId, Name]&#39;</span> <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    --output text | sort -k2

<span style="color:#75715e"># delete an AMI, by ImageId</span>
aws ec2 deregister-image --image-id ami-00000000

</code></pre></div><h2 id="instances">Instances</h2>
<p><a href="http://docs.aws.amazon.com/cli/latest/reference/ec2/index.html">http://docs.aws.amazon.com/cli/latest/reference/ec2/index.html</a></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="color:#75715e"># list all instances (running, and not running)</span>
<span style="color:#75715e"># http://docs.aws.amazon.com/cli/latest/reference/ec2/describe-instances.html</span>
aws ec2 describe-instances

<span style="color:#75715e"># list all instances running</span>
aws ec2 describe-instances --filters Name<span style="color:#f92672">=</span>instance-state-name,Values<span style="color:#f92672">=</span>running

<span style="color:#75715e"># create a new instance</span>
<span style="color:#75715e"># http://docs.aws.amazon.com/cli/latest/reference/ec2/run-instances.html</span>
aws ec2 run-instances <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    --image-id ami-f0e7d19a <span style="color:#ae81ff">\	</span>
    --instance-type t2.micro <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    --security-group-ids sg-00000000 <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    --dry-run

<span style="color:#75715e"># stop an instance</span>
<span style="color:#75715e"># http://docs.aws.amazon.com/cli/latest/reference/ec2/terminate-instances.html</span>
aws ec2 terminate-instances <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    --instance-ids &lt;instance_id&gt;

<span style="color:#75715e"># list status of all instances</span>
<span style="color:#75715e"># http://docs.aws.amazon.com/cli/latest/reference/ec2/describe-instance-status.html</span>
aws ec2 describe-instance-status

<span style="color:#75715e"># list status of a specific instance</span>
aws ec2 describe-instance-status <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    --instance-ids &lt;instance_id&gt;
    
<span style="color:#75715e"># list all running instance, Name tag and Public IP Address</span>
aws ec2 describe-instances <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>  --filters Name<span style="color:#f92672">=</span>instance-state-name,Values<span style="color:#f92672">=</span>running <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>  --query <span style="color:#e6db74">&#39;Reservations[].Instances[].[PublicIpAddress, Tags[?Key==`Name`].Value | [0] ]&#39;</span> <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>  --output text | sort -k2
</code></pre></div><h3 id="tags">Tags</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="color:#75715e"># list the tags of an instance</span>
<span style="color:#75715e"># http://docs.aws.amazon.com/cli/latest/reference/ec2/describe-tags.html</span>
aws ec2 describe-tags

<span style="color:#75715e"># add a tag to an instance</span>
<span style="color:#75715e"># http://docs.aws.amazon.com/cli/latest/reference/ec2/create-tags.html</span>
aws ec2 create-tags <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    --resources <span style="color:#e6db74">&#34;ami-1a2b3c4d&#34;</span> <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    --tags Key<span style="color:#f92672">=</span>name,Value<span style="color:#f92672">=</span>debian

<span style="color:#75715e"># delete a tag on an instance</span>
<span style="color:#75715e"># http://docs.aws.amazon.com/cli/latest/reference/ec2/delete-tags.html</span>
aws ec2 delete-tags <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    --resources <span style="color:#e6db74">&#34;ami-1a2b3c4d&#34;</span> <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    --tags Key<span style="color:#f92672">=</span>Name,Value<span style="color:#f92672">=</span>
</code></pre></div><p><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --></p>
<h2 id="cloudwatch">Cloudwatch</h2>
<h3 id="log-groups">Log Groups</h3>
<p><a href="http://docs.aws.amazon.com/AmazonCloudWatch/latest/DeveloperGuide/WhatIsCloudWatchLogs.html">http://docs.aws.amazon.com/AmazonCloudWatch/latest/DeveloperGuide/WhatIsCloudWatchLogs.html</a>
<a href="http://docs.aws.amazon.com/cli/latest/reference/logs/index.html#cli-aws-logs">http://docs.aws.amazon.com/cli/latest/reference/logs/index.html#cli-aws-logs</a></p>
<h5 id="create-a-group">create a group</h5>
<p><a href="http://docs.aws.amazon.com/cli/latest/reference/logs/create-log-group.html">http://docs.aws.amazon.com/cli/latest/reference/logs/create-log-group.html</a></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">aws logs create-log-group <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>	--log-group-name <span style="color:#e6db74">&#34;DefaultGroup&#34;</span>
</code></pre></div><h5 id="list-all-log-groups">list all log groups</h5>
<p><a href="http://docs.aws.amazon.com/cli/latest/reference/logs/describe-log-groups.html">http://docs.aws.amazon.com/cli/latest/reference/logs/describe-log-groups.html</a></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">aws logs describe-log-groups

aws logs describe-log-groups <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>	--log-group-name-prefix <span style="color:#e6db74">&#34;Default&#34;</span>
</code></pre></div><h5 id="delete-a-group">delete a group</h5>
<p><a href="http://docs.aws.amazon.com/cli/latest/reference/logs/delete-log-group.html">http://docs.aws.amazon.com/cli/latest/reference/logs/delete-log-group.html</a></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">aws logs delete-log-group <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>	--log-group-name <span style="color:#e6db74">&#34;DefaultGroup&#34;</span>
</code></pre></div><h3 id="log-streams">Log Streams</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">
<span style="color:#75715e"># Log group names can be between 1 and 512 characters long. Allowed</span>
<span style="color:#75715e"># characters include a-z, A-Z, 0-9, &#39;_&#39; (underscore), &#39;-&#39; (hyphen),</span>
<span style="color:#75715e"># &#39;/&#39; (forward slash), and &#39;.&#39; (period).</span>

<span style="color:#75715e"># create a log stream</span>
<span style="color:#75715e"># http://docs.aws.amazon.com/cli/latest/reference/logs/create-log-stream.html</span>
aws logs create-log-stream <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>	--log-group-name <span style="color:#e6db74">&#34;DefaultGroup&#34;</span> <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>	--log-stream-name <span style="color:#e6db74">&#34;syslog&#34;</span>

<span style="color:#75715e"># list details on a log stream</span>
<span style="color:#75715e"># http://docs.aws.amazon.com/cli/latest/reference/logs/describe-log-streams.html</span>
aws logs describe-log-streams <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>	--log-group-name <span style="color:#e6db74">&#34;syslog&#34;</span>

aws logs describe-log-streams <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>	--log-stream-name-prefix <span style="color:#e6db74">&#34;syslog&#34;</span>

<span style="color:#75715e"># delete a log stream</span>
<span style="color:#75715e"># http://docs.aws.amazon.com/cli/latest/reference/logs/delete-log-stream.html</span>
aws logs delete-log-stream <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>	--log-group-name <span style="color:#e6db74">&#34;DefaultGroup&#34;</span> <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>	--log-stream-name <span style="color:#e6db74">&#34;Default Stream&#34;</span>
</code></pre></div><h2 id="cloudwatch---monitoring">Cloudwatch - Monitoring</h2>
<p><a href="http://docs.aws.amazon.com/cli/latest/reference/cloudwatch/index.html">http://docs.aws.amazon.com/cli/latest/reference/cloudwatch/index.html</a></p>

		</div>
		<footer class="post__footer">
			
<div class="post__tags tags clearfix">
	<svg class="tags__badge icon icon-tag" width="16" height="16" viewBox="0 0 32 32"><path d="M32 19c0 1-1 2-1 2L21 31s-1 1-2 1-2-1-2-1L2 16c-1-1-1.4-2-1.4-2S0 12.5 0 11V3C0 1.5.8.8.8.8S1.5 0 3 0h8c1.5 0 3 .6 3 .6S15 1 16 2l15 15s1 1 1 2zM7 10a3 3 0 1 0 0-6 3 3 0 0 0 0 6z"/></svg>
	<ul class="tags__list">
		<li class="tags__item">
			<a class="tags__link btn" href="/tags/devops/" rel="tag">DEVOPS</a>
		</li>
		<li class="tags__item">
			<a class="tags__link btn" href="/tags/aws/" rel="tag">AWS</a>
		</li>
		<li class="tags__item">
			<a class="tags__link btn" href="/tags/cli/" rel="tag">CLI</a>
		</li>
	</ul>
</div>

		</footer>
	</article>
</main>

<div class="authorbox clearfix">
	<figure class="authorbox__avatar">
		<img alt="Nathan Obert avatar" src="/img/nathan.jpg" class="avatar" height="90" width="90">
	</figure>
	<div class="authorbox__header">
		<span class="authorbox__name">About Nathan Obert</span>
	</div>
</div>

<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/cheatsheet-helm/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">HELM Cheatsheet</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/blog-aws-cli/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Amazon Web Services (AWS) Command Line Interface (CLI) on Windows 11</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2023 Nathan Obert.

		</div>
	</div>
</footer>

	</div>
<script async defer src="/js/menu.js"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.6/MathJax.js?config=TeX-AMS-MML_HTMLorMML" async></script>
</body>
</html>