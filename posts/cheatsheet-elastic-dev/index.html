<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<title>Elastic Developer Cheatsheet - Nathan Obert</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="Elastic Developer Cheatsheet">
		<meta property="og:title" content="Elastic Developer Cheatsheet" />
<meta property="og:description" content="Elastic Developer Cheatsheet" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://www.nathanobert.com/posts/cheatsheet-elastic-dev/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-05-01T09:45:00-07:00" />
<meta property="article:modified_time" content="2023-05-01T09:45:00-07:00" />

		<meta itemprop="name" content="Elastic Developer Cheatsheet">
<meta itemprop="description" content="Elastic Developer Cheatsheet"><meta itemprop="datePublished" content="2023-05-01T09:45:00-07:00" />
<meta itemprop="dateModified" content="2023-05-01T09:45:00-07:00" />
<meta itemprop="wordCount" content="1383">
<meta itemprop="keywords" content="ELASTIC,DEVELOPMENT," />
		<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Elastic Developer Cheatsheet"/>
<meta name="twitter:description" content="Elastic Developer Cheatsheet"/>

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo logo--mixed">
		<a class="logo__link" href="/" title="Nathan Obert" rel="home">
			<div class="logo__item logo__imagebox">
					<img class="logo__img" src="/img/nathan.jpg">
				</div><div class="logo__item logo__text">
					<div class="logo__title">Nathan Obert</div>
					
				</div>
		</a>
	</div>
		
<nav class="menu">
	<button class="menu__btn" aria-haspopup="true" aria-expanded="false" tabindex="0">
		<span class="menu__btn-title" tabindex="-1">Menu</span>
	</button>
	<ul class="menu__list">
		<li class="menu__item">
			<a class="menu__link" href="/">
				
				<span class="menu__text">Home</span>
				
			</a>
		</li>
		<li class="menu__item">
			<a class="menu__link" href="/categories/blog/">
				
				<span class="menu__text">Blog</span>
				
			</a>
		</li>
		<li class="menu__item">
			<a class="menu__link" href="/categories/youtube/">
				
				<span class="menu__text">YouTube</span>
				
			</a>
		</li>
		<li class="menu__item">
			<a class="menu__link" href="/categories/cheatsheets/">
				
				<span class="menu__text">Cheatsheets</span>
				
			</a>
		</li>
		<li class="menu__item">
			<a class="menu__link" href="/tags/">
				
				<span class="menu__text">Tags</span>
				
			</a>
		</li>
		<li class="menu__item">
			<a class="menu__link" href="/posts/about/">
				
				<span class="menu__text">About</span>
				
			</a>
		</li>
	</ul>
</nav>


	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Elastic Developer Cheatsheet</h1>
			<p class="post__lead">Cheatsheet for Elastic Developer</p>
			<div class="post__meta meta"><div class="meta__item-author meta__item">
	<svg class="meta__icon icon icon-author" width="16" height="16" viewBox="0 0 12 16"><path d="M6 1c2.2 0 3.5 2 3.5 4.5C9.5 7 8.9 8.2 8 9c2.9.8 4 2.5 4 5v1H0v-1c0-2.5 1.1-4.2 4-5-.9-.8-1.5-2-1.5-3.5C2.5 3 3.8 1 6 1z"/></svg><span class="meta__text">Nathan Obert</span>
</div>
<div class="meta__item-datetime meta__item">
	<svg class="meta__icon icon icon-time" width="16" height="14" viewBox="0 0 30 28"><path d="M15 0C7 0 1 6 1 14s6 14 14 14 14-6 14-14S23 0 15 0zm0 25C9 25 4 20 4 14S9 3 15 3s11 5 11 11-5 11-11 11zm1-18h-2v8.4l6.8 4.4L22 18l-6-3.8V7z"/></svg><time class="meta__text" datetime="2023-05-01T09:45:00-07:00">2023-05-01</time></div><div class="meta__item-categories meta__item"><svg class="meta__icon icon icon-category" width="16" height="16" viewBox="0 0 16 16"><path d="m7 2l1 2h8v11h-16v-13z"/></svg><span class="meta__text"><a class="meta__link" href="/categories/cheatsheets/" rel="category">Cheatsheets</a>
	</span>
</div>
<div class="post__tags tags clearfix">
        <svg class="tags__badge icon icon-tag" width="16" height="16" viewBox="0 0 32 32"><path d="M32 19c0 1-1 2-1 2L21 31s-1 1-2 1-2-1-2-1L2 16c-1-1-1.4-2-1.4-2S0 12.5 0 11V3C0 1.5.8.8.8.8S1.5 0 3 0h8c1.5 0 3 .6 3 .6S15 1 16 2l15 15s1 1 1 2zM7 10a3 3 0 1 0 0-6 3 3 0 0 0 0 6z"/></svg>
        <ul class="tags__list">
                <li class="tags__item">
                        <a class="tags__link btn" href="/tags/elastic/" rel="tag">ELASTIC</a>
                </li>
                <li class="tags__item">
                        <a class="tags__link btn" href="/tags/development/" rel="tag">DEVELOPMENT</a>
                </li>
        </ul>
</div>
</div>
		</header>
		
	<figure class="post__thumbnail thumbnail">
		
		<img class="thumbnail__image" src="/img/elastic.png" alt="Elastic Developer Cheatsheet">
		
	</figure>
<div class="post__toc toc">
	<div class="toc__title">Page content</div>
	<div class="toc__menu">
		<nav id="TableOfContents">
  <ul>
    <li><a href="#putgetdelete-index">Put/Get/Delete index</a></li>
    <li><a href="#putgetdelete-template">Put/Get/Delete template</a></li>
    <li><a href="#bulk-api">Bulk API</a></li>
    <li><a href="#ingest-api-putgetdeletesimulate-pipeline">Ingest API (put/get/delete/simulate pipeline)</a></li>
  </ul>

  <ul>
    <li><a href="#field-types">Field types</a></li>
    <li><a href="#analysis">Analysis</a></li>
    <li><a href="#analyze-api">Analyze API:</a></li>
    <li><a href="#mapping-options">Mapping options</a></li>
  </ul>

  <ul>
    <li><a href="#full-text-search">Full-text search</a></li>
    <li><a href="#filtering">Filtering</a></li>
    <li><a href="#wrappers">Wrappers</a></li>
  </ul>

  <ul>
    <li><a href="#term-occurrences">Term occurrences</a></li>
    <li><a href="#ranges">Ranges</a></li>
    <li><a href="#statistics">Statistics</a></li>
    <li><a href="#grouping-by-nesting-aggregations">Grouping by nesting aggregations</a></li>
  </ul>

  <ul>
    <li><a href="#objects">Objects</a></li>
    <li><a href="#nested">Nested</a></li>
    <li><a href="#parent-child">Parent-child</a></li>
  </ul>
</nav>
	</div>
</div><div class="content post__content clearfix">
			<h1 id="introduction">Introduction</h1>
<p>This is a quick cheat sheet from <a href="https://github.com/sematext/cheatsheets/blob/master/elasticsearch-developer-cheatsheet.md"> Sematext&rsquo;s Elastic Developer Cheatsheet</a></p>
<h1 id="data-manipulation">Data Manipulation</h1>
<h2 id="putgetdelete-index">Put/Get/Delete index</h2>
<pre><code>curl -XPUT localhost:9200/index-name -d '{&quot;settings&quot;: { &quot;number_of_shards&quot;: 1}}'
curl -XGET localhost:9200/index-name?pretty
curl -XDELETE localhost:9200/index-name
</code></pre>
<h2 id="putgetdelete-template">Put/Get/Delete template</h2>
<pre><code>curl -XPUT localhost:9200/_template/template-name -d '{
  &quot;template&quot;: &quot;logs*&quot;,
  &quot;mappings&quot;: {
    &quot;foo-type&quot;: {
      &quot;properties&quot;: {
        &quot;foo-field&quot;: {
          &quot;type&quot;: &quot;text&quot;
        }
      }
    }
  },
  &quot;settings&quot;: {
    &quot;number_of_shards&quot;: 1
  }
}'
curl -XGET localhost:9200/_template/template-name?pretty
curl -XDELETE localhost:9200/_template/template-name
</code></pre>
<h2 id="bulk-api">Bulk API</h2>
<pre><code>echo '{&quot;index&quot;: { &quot;_index&quot;: &quot;logs01&quot;, &quot;_type&quot;: &quot;logs&quot;}}
{&quot;title&quot;: &quot;this is an error&quot;}
{&quot;index&quot;: { &quot;_index&quot;: &quot;logs02&quot;, &quot;_type&quot;: &quot;logs&quot;}}
{&quot;title&quot;: &quot;this is a warning&quot;}
{&quot;delete&quot;: { &quot;_index&quot;: &quot;logs03&quot;, &quot;_type&quot;: &quot;logs&quot;, &quot;_id&quot;: &quot;abc123&quot;}}
' &gt; /tmp/bulk
curl localhost:9200/_bulk?pretty –data-binary @/tmp/bulk
</code></pre>
<h2 id="ingest-api-putgetdeletesimulate-pipeline">Ingest API (put/get/delete/simulate pipeline)</h2>
<pre><code>curl -XPUT localhost:9200/_ingest/pipeline/apache -d '{
  &quot;description&quot;: &quot;grok apache logs&quot;,
  &quot;processors&quot;: [
    {
      &quot;grok&quot;: {
        &quot;field&quot;: &quot;message&quot;,
        &quot;patterns&quot;: [&quot;%{COMBINEDAPACHELOG}%{GREEDYDATA:additional_fields}&quot;]
      }
    }
  ]
}'
curl -XGET localhost:9200/_ingest/pipeline/apache?pretty
curl -XDELETE localhost:9200/_ingest/pipeline/apache
curl -XPOSTlocalhost:9200/_ingest/pipeline/_simulate -d '{
  &quot;pipeline&quot;: {
    &quot;description&quot;: &quot;grok apache logs&quot;,
    &quot;processors&quot;: [
      {
        &quot;grok&quot;: {
          &quot;field&quot;: &quot;message&quot;,
          &quot;patterns&quot;: [
            &quot;%{COMBINEDAPACHELOG}%{GREEDYDATA:additional_fields}&quot;
          ]
        }
      }
    ]
  },
  &quot;docs&quot;: [
    {
      &quot;_source&quot;: {
        &quot;message&quot;: &quot;example.com – – [22/Apr/2016:18:52:51 +1200] \&quot;GET /images/photos/455.jpg HTTP/1.1\&quot; 200 986 \&quot;-\&quot; \&quot;Mozilla/5.0\&quot; \&quot;-\&quot;&quot;
      }
    }
  ]
}'
</code></pre>
<h1 id="mapping-parameters">Mapping parameters</h1>
<h2 id="field-types">Field types</h2>
<pre><code>curl -XPUT localhost:9200/index-name -d '{
  &quot;mappings&quot;: {
    &quot;foo-type&quot;: {
      &quot;properties&quot;: {
        &quot;foo&quot;: {
          &quot;type&quot;: &quot;text&quot;
        }
      }
    }
  }
}'
</code></pre>
<p>By default, string fields are mapped as both:</p>
<ul>
<li><strong>text</strong> – full-text search</li>
<li><strong>keyword</strong> – exact search, sorting and aggregations</li>
</ul>
<p>Numeric: <strong>byte, short, integer, long, float, scaled_float, half_float</strong>
Others: <strong>boolean, ip, geo_point, geo_shape</strong></p>
<h2 id="analysis">Analysis</h2>
<p>Analyzer components:</p>
<ul>
<li>
<p>[character filters]</p>
</li>
<li>
<p>tokenizer</p>
</li>
<li>
<p>[token filters]</p>
<pre><code> curl -XPUT localhost:9200/index-name -d '{
   &quot;settings&quot;: {
     &quot;analysis&quot;: {
       &quot;char_filter&quot;: {
         &quot;my_mapping_char_filter&quot;: {
           &quot;type&quot;: &quot;mapping&quot;,
           &quot;mappings&quot;: [&quot;&amp; =&gt; and&quot;]
         }
       },
       &quot;analyzer&quot;: {
         &quot;my_custom_analyzer&quot;: {
           &quot;char_filter&quot;: [&quot;my_mapping_char_filter&quot;],
           &quot;tokenizer&quot;: &quot;whitespace&quot;,
           &quot;filter&quot;: [&quot;lowercase&quot;]
         }
       }
     }
   },
   &quot;mappings&quot;: {
     &quot;foo-type&quot;: {
       &quot;properties&quot;: {
         &quot;foo&quot;: {
           &quot;type&quot;: &quot;text&quot;,
           &quot;analyzer&quot;: &quot;my_custom_analyzer&quot;
         }
       }
     }
   }
</code></pre>
</li>
</ul>
<h2 id="analyze-api">Analyze API:</h2>
<pre><code>curl -XPOST localhost:9200/index-name/_analyze -d '{
  &quot;text&quot;: [&quot;Fish &amp; Chips&quot;],
  &quot;analyzer&quot;: &quot;my_custom_analyzer&quot;
}'
 # reply
{
  &quot;tokens&quot;: [
    {
      &quot;token&quot;: &quot;fish&quot;,
      &quot;start_offset&quot;: 0,
      &quot;end_offset&quot;: 4,
      &quot;type&quot;: &quot;word&quot;,
      &quot;position&quot;: 0
    },
    {
      &quot;token&quot;: &quot;and&quot;,
…
    },
    {
      &quot;token&quot;: &quot;chips&quot;,
…
</code></pre>
<p>Important default analyzers:</p>
<ul>
<li><strong>standard</strong> – tokenizes European languages OK, lowercases</li>
<li>language (e.g. <strong>english, dutch</strong>) – selects the appropriate tokenizer (often <strong>standard</strong>), lowercases, removes stopwords and stems</li>
</ul>
<p>Important character filters:</p>
<ul>
<li><strong>html_strip</strong> – removes HTML elements and decodes HTML character
entities</li>
<li><strong>pattern_replace</strong> – replaces regular expression matches</li>
</ul>
<p>Important tokenizers:</p>
<ul>
<li><strong>standard</strong> – the same used in the Standard Analyzer</li>
<li><strong>letter</strong> – tokens are only groups of letters</li>
<li><strong>whitespace</strong> – treats whitespaces as separators</li>
<li><strong>pattern</strong> – regular expression as separator</li>
<li><strong>keyword</strong> – treats the whole string as a token</li>
</ul>
<p>Important token filters:</p>
<ul>
<li><strong>lowercase</strong> or <strong>uppercase</strong> – folds cases</li>
<li><strong>asciifolding</strong> – folds non-ASCII characters to ASCII equivalents for
european languages</li>
<li><strong>stemmer</strong> – reduces words to their roots (with configurable
aggressiveness)</li>
<li><strong>synonym</strong> – adds synonym tokens to the index</li>
<li><strong>ngram</strong> – creates tokens out of groups of consecutive letters</li>
<li><strong>edge ngram</strong> – ngrams for prefixes</li>
<li><strong>reverse</strong> – flips character order (combine with edge ngram for suffix
matching)</li>
<li><strong>shingle</strong> – word ngrams</li>
</ul>
<h2 id="mapping-options">Mapping options</h2>
<pre><code>curl -XPUT localhost:9200/index-name -d '{
  &quot;mappings&quot;: {
    &quot;foo-type&quot;: {
      &quot;properties&quot;: {
        &quot;foo&quot;: {
          &quot;type&quot;: &quot;text&quot;,
          &quot;index_options&quot;: &quot;docs&quot;,
          &quot;norms&quot;: false,
          &quot;fields&quot;: {
            &quot;keyword&quot;: {
              &quot;type&quot;: &quot;keyword&quot;,
              &quot;doc_values&quot;: true,
              &quot;index&quot;: false
            }
          }
        }
      }
    }
  }
}'
</code></pre>
<ul>
<li><strong>doc_values</strong> (true/false) – for sorting and aggregations on a field</li>
<li><strong>index</strong> (true/false) – for searching on a field</li>
<li><strong>index_options</strong> – whether to index only the term (<strong>docs</strong>), or also its
frequency (<strong>freqs</strong>) and where it occurs (<strong>positions</strong> and <strong>offsets</strong>)</li>
<li><strong>norms</strong> (true/false) – for normalizing scores relative to field length</li>
<li><strong>ignore_above</strong> – don’t index terms bigger than N characters</li>
</ul>
<h1 id="queries">Queries</h1>
<h2 id="full-text-search">Full-text search</h2>
<p>Lucene query syntax: <strong>query_string</strong></p>
<pre><code>curl localhost:9200/index-name/_search -d '{
  &quot;query&quot;: {
    &quot;query_string&quot;: {
      &quot;query&quot;: &quot;+fish +chips&quot;
    }
  }
}'
</code></pre>
<p>Options:</p>
<ul>
<li><strong>field:value</strong> to look in <strong>field</strong>, or search in all fields (default) or in
a specified <strong>default_field</strong></li>
<li>+requiredTerm -excludedTerm. Or you can say <strong>requiredTerm1</strong> AND <strong>requiredTerm2</strong></li>
<li><strong>(firstName AND lastName) OR alias</strong></li>
<li><strong>Ealsticsearch~1</strong> (fuzziness of one character to tolerate typos)</li>
<li><strong>&ldquo;Sematext consulting Elasticsearch&rdquo;~2</strong> (slop of two words)</li>
<li><strong>E?asticse</strong>*</li>
<li>*<em>date:[2017-01-01 TO 2018-01-01] OR rating:[3 TO <em>]</em></em></li>
<li><strong>boostThisTermByTen^10</strong></li>
<li>escape special characters (?*~^:+-), use a backslash ()</li>
</ul>
<p>Text-box like search: <strong>match</strong></p>
<pre><code> &quot;query&quot;: {
    &quot;match&quot;: {
      &quot;foo&quot;: {
        &quot;query&quot;: &quot;bar baz&quot;,
        &quot;operator&quot;: &quot;OR&quot;
      }
    }
  }
</code></pre>
<p>Options:</p>
<ul>
<li>
<p>fuzziness allows typos to be tolerated</p>
</li>
<li>
<p>cutoff_frequency high-frequency terms are searched only on results of
the low-frequency terms For match on multiple fields: multi_match</p>
<p>&ldquo;multi_match&rdquo;: {
&ldquo;query&rdquo;: &ldquo;fish chips&rdquo;,
&ldquo;fields&rdquo;: [&ldquo;foo&rdquo;, &ldquo;bar&rdquo;]
}</p>
</li>
</ul>
<p>Can set <strong>type</strong> to:</p>
<ul>
<li><strong>best_fields</strong> (default): takes the highest scoring field into account,
optionally taking a fraction of the others (as defined by
<strong>tie_breaker</strong>)</li>
<li><strong>most_fields</strong>: sums up scores of all fields (equivalent to best_fields
with tie_breaker=1)</li>
<li><strong>cross_fields</strong>: treats multiple fields as one</li>
<li><strong>phrase</strong>: like best_fields, but matches phrases with a configurable
slop</li>
<li><strong>phrase_prefix</strong>: like phrase, but considers the prefix of the last term</li>
</ul>
<h2 id="filtering">Filtering</h2>
<p>Exact values: <strong>term</strong> and <strong>terms</strong></p>
<pre><code>&quot;term&quot;: {
  &quot;foo&quot;: &quot;fish&quot;
}
</code></pre>
<p><strong>range</strong></p>
<pre><code>&quot;range&quot;: {
  &quot;retweets&quot;: {
    &quot;gte&quot;: 10,
    &quot;lte&quot;: 20
  }
}
</code></pre>
<h2 id="wrappers">Wrappers</h2>
<p>Combining other queries: <strong>bool</strong></p>
<pre><code>&quot;bool&quot;: {
  &quot;must&quot;: {
    &quot;match&quot;: {
      &quot;foo&quot;: &quot;fish&quot;
    }
  },
  &quot;filter&quot;: {
    &quot;range&quot;: {
      &quot;retweets&quot;: {
        &quot;gte&quot;: 10
      }
    }
  }
}
</code></pre>
<p>Clauses:</p>
<ul>
<li><strong>must</strong>: queries required both to produce a hit and for scoring</li>
<li><strong>should</strong>: queries that, if matched, contribute to the score</li>
<li><strong>filter</strong>: required queries, not influencing score (cacheable)</li>
<li><strong>must_not</strong>: cacheable queries that are required not to match</li>
</ul>
<p>Alters score to [a subset of] results: <strong>function_score</strong></p>
<pre><code>  &quot;function_score&quot;: {
      &quot;query&quot;: {
        &quot;match&quot;: {
          &quot;foo&quot;: &quot;fish&quot;
        }
      },
      &quot;functions&quot;: [
        {
          &quot;filter&quot;: {
            &quot;range&quot;: {
              &quot;retweets&quot;: {
                &quot;gte&quot;: 10
              }
            }
          },
          &quot;weight&quot;: 5
        }
      ]
    }
</code></pre>
<p>Functions:</p>
<ul>
<li>weight/random_score: multiply the score by a static or a random
number</li>
<li>field_value_factor: multiply the score by a factor (e.g. square root)
of the value of a field</li>
<li>linear/exp/gauss decay: reduce the score based on how far the value
of a field is from a specified origin script: use a script to
generate a weight</li>
</ul>
<h1 id="aggregations">Aggregations</h1>
<pre><code>curl localhost:9200/index-name/_search -d '{
  &quot;size&quot;: 0,
  &quot;aggs&quot;: {
    &quot;most_foos&quot;: {
      &quot;terms&quot;: {
        &quot;field&quot;: &quot;foo.keyword&quot;
      }
    }
  }
}'
</code></pre>
<h2 id="term-occurrences">Term occurrences</h2>
<ul>
<li><strong>terms</strong>: by default, most occurrences of a term. Can order by other
criteria (including other aggregations)</li>
<li><strong>significant_terms</strong>: terms occurring more often in the query results
compared to overall. More expensive, may want to use the <strong>sampler</strong>
aggregation</li>
</ul>
<h2 id="ranges">Ranges</h2>
<ul>
<li><strong>range</strong>: buckets of documents from defined numeric ranges</li>
<li><strong>date_range/ip_range</strong>: same as range, but for dates and IPs</li>
<li><strong>histogram/date_histogram</strong>: ranges are fixed from an interval</li>
</ul>
<h2 id="statistics">Statistics</h2>
<pre><code>&quot;aggs&quot;: {
    &quot;avg_retweets&quot;: {
      &quot;avg&quot;: {
        &quot;field&quot;: &quot;retweets&quot;
      }
    }
  }
</code></pre>
<ul>
<li><strong>value_count/min/max/avg/sum</strong> of values from a field</li>
<li><strong>percentiles</strong> from a numeric field are approximate</li>
<li><strong>cardinality</strong> of terms is also approximate</li>
</ul>
<h2 id="grouping-by-nesting-aggregations">Grouping by nesting aggregations</h2>
<p>The following gets the top results, ordered by <strong>_score</strong>, grouped by the value of <strong>bar</strong> (one hit per value).</p>
<pre><code> &quot;query&quot;: {
    &quot;match&quot;: {
      &quot;foo&quot;: &quot;fish&quot;
    }
  },
  &quot;size&quot;: 0,
  &quot;aggs&quot;: {
    &quot;most_foo&quot;: {
      &quot;terms&quot;: {
        &quot;field&quot;: &quot;bar.keyword&quot;,
        &quot;order&quot;: {
          &quot;max_score&quot;: &quot;desc&quot;
        }
      },
      &quot;aggs&quot;: {
        &quot;max_score&quot;: {
          &quot;max&quot;: {
            &quot;script&quot;: {
              &quot;inline&quot;: &quot;_score&quot;
            }
          }
        },
        &quot;top_hit&quot;: {
          &quot;top_hits&quot;: {
            &quot;size&quot;: 1
          }
        }
      }
    }
  }
</code></pre>
<h1 id="document-relationships">Document relationships</h1>
<h2 id="objects">Objects</h2>
<p>Good for one-to-one relations or when you’re searching a single field:</p>
<pre><code>curl -XPOST localhost:9200/blog/posts/ -d '{
  &quot;title&quot;: &quot;Fish &amp; Chips&quot;,
  &quot;author&quot;: {
    &quot;first_name&quot;: &quot;John&quot;,
    &quot;last_name&quot;: &quot;Smith&quot;
  }
}'
</code></pre>
<h2 id="nested">Nested</h2>
<p>When you need boundaries between objects (e.g. <strong>first_name:jane AND last_name:smith</strong>). Mapping needs to specify that the parent field is <strong>nested</strong>:</p>
<pre><code>&quot;mappings&quot;: {
    &quot;posts&quot;: {
      &quot;properties&quot;: {
        &quot;authors&quot;: {
          &quot;type&quot;: &quot;nested&quot;
        }
      }
    }
  }
</code></pre>
<p>Documents look like regular objects (even though they’re separate Lucene documents):</p>
<pre><code>&quot;authors&quot;: [
    {
    &quot;first_name&quot;: &quot;John&quot;,
    &quot;last_name&quot;: &quot;Smith&quot;
    },
    {
      &quot;first_name&quot;: &quot;Jane&quot;,
      &quot;last_name&quot;: &quot;Adams&quot;
    }
  ]
</code></pre>
<p>Queries (and aggregations) need to be aware of this and do the join:</p>
<pre><code> &quot;query&quot;: {
       &quot;nested&quot;: {
         &quot;path&quot;: &quot;authors&quot;,
         &quot;query&quot;: {
           &quot;match&quot;: {
             &quot;authors.first_name&quot;: &quot;Jane&quot;
           }
         }
       }   
     }
</code></pre>
<h2 id="parent-child">Parent-child</h2>
<p>When updates are frequent and you want to avoid reindexing the whole ensemble (as you would with nested documents). These are completely separate documents, going in different types:</p>
<pre><code>&quot;mappings&quot;: {
    &quot;authors&quot;: {
      &quot;_parent&quot;: {
        &quot;type&quot;: &quot;posts&quot;
      }
    }
  }
</code></pre>
<p>Children point to parents via the <strong>_parent field</strong>:</p>
<pre><code>curl -XPOST localhost:9200/blog/posts/1 -d '{
  &quot;title&quot;: &quot;Fish &amp; Chips&quot;
}'
curl -XPOST localhost:9200/blog/authors?parent=1 -d '{
  &quot;first_name&quot;: &quot;John&quot;,
  &quot;last_name&quot;: &quot;Smith&quot;
}'
curl -XPOSTlocalhost:9200/blog/authors?parent=1 -d '{
  &quot;first_name&quot;: &quot;Jane&quot;,
  &quot;last_name&quot;: &quot;Adams&quot;
}'
Like with nested documents, the query has to specify that a join needs to be done:
  &quot;query&quot;: {
    &quot;has_child&quot;: {
      &quot;type&quot;: &quot;authors&quot;,
      &quot;query&quot;: {
        &quot;match&quot;: {
          &quot;first_name&quot;: &quot;Jane&quot;
        }
      }
    }
  }
</code></pre>

		</div>
		<footer class="post__footer">
			
<div class="post__tags tags clearfix">
	<svg class="tags__badge icon icon-tag" width="16" height="16" viewBox="0 0 32 32"><path d="M32 19c0 1-1 2-1 2L21 31s-1 1-2 1-2-1-2-1L2 16c-1-1-1.4-2-1.4-2S0 12.5 0 11V3C0 1.5.8.8.8.8S1.5 0 3 0h8c1.5 0 3 .6 3 .6S15 1 16 2l15 15s1 1 1 2zM7 10a3 3 0 1 0 0-6 3 3 0 0 0 0 6z"/></svg>
	<ul class="tags__list">
		<li class="tags__item">
			<a class="tags__link btn" href="/tags/elastic/" rel="tag">ELASTIC</a>
		</li>
		<li class="tags__item">
			<a class="tags__link btn" href="/tags/development/" rel="tag">DEVELOPMENT</a>
		</li>
	</ul>
</div>

		</footer>
	</article>
</main>

<div class="authorbox clearfix">
	<figure class="authorbox__avatar">
		<img alt="Nathan Obert avatar" src="/img/nathan.jpg" class="avatar" height="90" width="90">
	</figure>
	<div class="authorbox__header">
		<span class="authorbox__name">About Nathan Obert</span>
	</div>
</div>

<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/cheatsheet-elastic-devops/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Elastic Devops Cheatsheet</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/cheatsheet-docker/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Docker Cheatsheet</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2023 Nathan Obert.

		</div>
	</div>
</footer>

	</div>
<script async defer src="/js/menu.js"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.6/MathJax.js?config=TeX-AMS-MML_HTMLorMML" async></script>
</body>
</html>